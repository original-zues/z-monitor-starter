<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Z Monitor - SRE Command Center v5</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #3b82f6; --bg: #030712; --glass: rgba(17, 24, 39, 0.7); --border: rgba(255, 255, 255, 0.08); }
        body { background: var(--bg); color: #94a3b8; font-family: 'Plus Jakarta Sans', sans-serif; overflow: hidden; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .glass { background: var(--glass); backdrop-filter: blur(12px); border: 1px solid var(--border); box-shadow: 0 8px 32px 0 rgba(0,0,0,0.8); }
        .sidebar-active { background: rgba(59, 130, 246, 0.1); border-left: 3px solid var(--accent); color: #fff; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
        .pulse-emerald { box-shadow: 0 0 15px rgba(16, 185, 129, 0.4); animation: pulse-emerald 2s infinite; }
        @keyframes pulse-emerald { 0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); } 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); } }
        .bento-grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 1.5rem; }
    </style>
</head>
<body class="h-screen flex selection:bg-blue-500/30">
    <!-- Sidebar -->
    <aside class="w-64 glass border-r border-white/5 flex flex-col z-50">
        <div class="p-8 border-b border-white/5">
            <div class="flex items-center space-x-3 mb-2">
                <div class="w-8 h-8 bg-gradient-to-tr from-blue-600 to-indigo-600 rounded-lg flex items-center justify-center text-white font-black shadow-lg">A</div>
                <h1 class="text-xs font-black text-white tracking-[0.4em] uppercase">Z Monitor</h1>
            </div>
            <p class="text-[9px] font-bold text-slate-500 uppercase tracking-widest">v5.0.4-Obsidian</p>
        </div>
        
        <nav class="flex-1 p-4 space-y-2 mt-4">
            <button onclick="switchTab('dashboard')" id="btn-dashboard" class="sidebar-btn w-full flex items-center px-4 py-3 rounded-xl transition-all hover:bg-white/5 text-[11px] font-bold uppercase tracking-widest sidebar-active">
                <svg class="w-4 h-4 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                Telemetry
            </button>
            <button onclick="switchTab('loggers')" id="btn-loggers" class="sidebar-btn w-full flex items-center px-4 py-3 rounded-xl transition-all hover:bg-white/5 text-[11px] font-bold uppercase tracking-widest">
                <svg class="w-4 h-4 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                Diagnostics
            </button>
            <button onclick="switchTab('threads')" id="btn-threads" class="sidebar-btn w-full flex items-center px-4 py-3 rounded-xl transition-all hover:bg-white/5 text-[11px] font-bold uppercase tracking-widest">
                <svg class="w-4 h-4 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path></svg>
                Processes
            </button>
        </nav>
        
        <div class="p-6 border-t border-white/5">
            <button onclick="logout()" class="w-full flex items-center justify-center space-x-2 py-3 bg-rose-500/10 text-rose-500 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all hover:bg-rose-500 hover:text-white">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                <span>Terminate</span>
            </button>
        </div>
    </aside>

    <!-- Main Viewport -->
    <main class="flex-1 overflow-y-auto relative bg-[#030712] custom-scrollbar">
        <!-- Persistent Telemetry Header -->
        <header class="glass border-b border-white/5 h-16 flex items-center justify-between px-10 sticky top-0 z-40">
            <div class="flex items-center space-x-12">
                <div class="flex flex-col">
                    <span class="text-[9px] font-black text-slate-600 uppercase tracking-[0.2em]">Region (Yangon Time)</span>
                    <span id="yangonClock" class="text-sm font-bold text-blue-400 mono tracking-tighter">--:--:-- MM-T</span>
                </div>
                <div class="flex flex-col">
                    <span class="text-[9px] font-black text-slate-600 uppercase tracking-[0.2em]">Deployment Status</span>
                    <div class="flex items-center space-x-2">
                        <div id="healthDot" class="w-2 h-2 rounded-full bg-emerald-500 shadow-lg"></div>
                        <span id="globalHealth" class="text-xs font-black text-white uppercase tracking-tighter">System Normal</span>
                    </div>
                </div>
                <div class="flex flex-col">
                    <span class="text-[9px] font-black text-slate-600 uppercase tracking-[0.2em]">Edge Performance</span>
                    <span id="rpsValue" class="text-xs font-bold text-white mono">0.00 RPS</span>
                </div>
            </div>
            
            <div class="flex items-center space-x-6">
                <div class="text-right hidden sm:block">
                    <p id="adminUser" class="text-xs font-black text-white uppercase">Administrator</p>
                    <p class="text-[9px] text-slate-500 uppercase font-bold">Node: master-backend-01</p>
                </div>
                <div class="w-10 h-10 rounded-2xl bg-gradient-to-tr from-slate-800 to-slate-900 border border-white/10 flex items-center justify-center text-blue-500 font-black shadow-xl">A</div>
            </div>
        </header>

        <div class="p-10 space-y-10">
            <!-- Telemetry Overview (Bento Grid) -->
            <div id="tab-dashboard" class="tab-content active bento-grid">
                
                <!-- Active User Load (Span 3) -->
                <div class="col-span-12 lg:col-span-3 glass p-8 rounded-[2rem] flex flex-col justify-between h-48 group relative overflow-hidden">
                    <div class="absolute -right-4 -bottom-4 opacity-[0.03] group-hover:opacity-[0.08] transition-opacity">
                        <svg class="w-40 h-40" fill="currentColor" viewBox="0 0 20 20"><path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"></path></svg>
                    </div>
                    <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Active User Lifecycle</p>
                    <div class="flex items-baseline space-x-3">
                        <p id="activeUsers" class="text-5xl font-black text-white tracking-tighter">0</p>
                        <span class="text-xs text-blue-500 font-bold uppercase">/ <span id="totalUsers">0</span> Total</span>
                    </div>
                    <p class="text-[10px] text-slate-600 font-bold uppercase">New Registrations Today: <span id="newUsers" class="text-white">0</span></p>
                </div>

                <!-- Active Request Analytics (Span 3) -->
                <div class="col-span-12 lg:col-span-3 glass p-8 rounded-[2rem] flex flex-col justify-between h-48 group">
                    <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Edge Workload (Active)</p>
                    <div class="flex items-baseline space-x-3">
                        <p id="activeReqs" class="text-5xl font-black text-emerald-400 tracking-tighter">0</p>
                        <span class="text-xs text-emerald-600 font-bold uppercase">Requests</span>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between text-[10px] font-bold uppercase text-slate-600"><span>Saturation Index</span> <span id="reqSaturation" class="text-white">0%</span></div>
                        <div class="w-full bg-white/5 h-1.5 rounded-full overflow-hidden"><div id="reqBar" class="bg-emerald-500 h-full transition-all duration-700" style="width: 0%"></div></div>
                    </div>
                </div>

                <!-- IO / Handle Audit (Span 3) -->
                <div class="col-span-12 lg:col-span-3 glass p-8 rounded-[2rem] flex flex-col justify-between h-48 group">
                    <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Process Handle Audit (FD)</p>
                    <div class="flex items-baseline space-x-3">
                        <p id="openFiles" class="text-5xl font-black text-amber-500 tracking-tighter">0</p>
                        <span class="text-xs text-amber-600 font-bold uppercase">Open</span>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between text-[10px] font-bold uppercase text-slate-600"><span>I/O Threshold</span> <span class="text-white">STABLE</span></div>
                        <div class="w-full bg-white/5 h-1.5 rounded-full overflow-hidden"><div id="fdBar" class="bg-amber-500 h-full transition-all duration-700" style="width: 15%"></div></div>
                    </div>
                </div>

                <!-- DB Pool Health (Span 3) -->
                <div class="col-span-12 lg:col-span-3 glass p-8 rounded-[2rem] flex flex-col justify-between h-48 group">
                    <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">HikariCP Pool State</p>
                    <div class="flex items-baseline space-x-3">
                        <p id="dbActive" class="text-5xl font-black text-indigo-400 tracking-tighter">0</p>
                        <span class="text-xs text-indigo-600 font-bold uppercase">/ <span id="dbMax">0</span> MAX</span>
                    </div>
                    <div class="flex justify-between items-center text-[10px] font-bold">
                        <div class="flex items-center space-x-2"><div id="dbPulse" class="w-2 h-2 rounded-full bg-emerald-500 pulse-emerald"></div> <span class="text-slate-600 uppercase">Synchronized</span></div>
                        <span id="dbPending" class="text-slate-500">PEND: 0</span>
                    </div>
                </div>

                <!-- Real-time Memory Stream (Span 8) -->
                <div class="col-span-12 lg:col-span-8 glass p-10 rounded-[2.5rem] space-y-8">
                    <div class="flex items-center justify-between">
                        <div class="flex flex-col">
                            <h3 class="text-sm font-black text-white uppercase tracking-widest">JVM Memory lifecycle stream</h3>
                            <p class="text-[10px] text-slate-600 mt-1 uppercase font-bold">Continuous audit of Heap vs Non-Heap allocation</p>
                        </div>
                        <div class="flex space-x-10 items-center">
                            <div class="flex flex-col text-right"><span class="text-[9px] text-slate-500 font-black uppercase">Heap Used</span><span id="heapText" class="text-sm font-black text-white mono">0 MB</span></div>
                            <div class="flex flex-col text-right"><span class="text-[9px] text-slate-500 font-black uppercase">Max Committed</span><span id="maxHeapText" class="text-sm font-black text-slate-600 mono">0 MB</span></div>
                        </div>
                    </div>
                    <div class="h-96"><canvas id="memStreamChart"></canvas></div>
                </div>

                <!-- System Load & Component Health (Span 4) -->
                <div class="col-span-12 lg:col-span-4 glass p-10 rounded-[2.5rem] space-y-10">
                    <h3 class="text-[10px] font-black text-slate-500 uppercase tracking-[0.2em]">Infrastructure Saturation</h3>
                    
                    <div class="space-y-8">
                        <div>
                            <div class="flex justify-between text-[10px] font-black uppercase mb-3"><span class="text-slate-500">System CPU Load</span><span id="cpuText" class="text-white">0.0%</span></div>
                            <div class="w-full bg-white/5 h-2 rounded-full overflow-hidden"><div id="cpuGauge" class="bg-blue-500 h-full transition-all duration-700" style="width: 0%"></div></div>
                        </div>
                        <div>
                            <div class="flex justify-between text-[10px] font-black uppercase mb-3"><span class="text-slate-500">Sys Load (1m)</span><span id="loadText" class="text-white">0.00</span></div>
                            <div class="w-full bg-white/5 h-2 rounded-full overflow-hidden"><div id="loadGauge" class="bg-indigo-500 h-full transition-all duration-700" style="width: 0%"></div></div>
                        </div>
                    </div>

                    <div class="pt-10 border-t border-white/5 space-y-4">
                        <p class="text-[9px] font-black text-slate-600 uppercase tracking-widest">Sub-system Health Breakdown</p>
                        <div id="healthDetailsGrid" class="space-y-3">
                            <!-- Dynamic health rows -->
                        </div>
                    </div>
                </div>

                <!-- Diagnostic Registry (Span 12) -->
                <div class="col-span-12 glass rounded-[2.5rem] overflow-hidden">
                    <div class="px-10 py-6 border-b border-white/5 flex items-center justify-between bg-white/[0.01]">
                        <h3 class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Technical Runtime Registry</h3>
                        <span id="lastUpdatedYangon" class="text-[9px] font-bold text-slate-600 uppercase">--:--:--</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-[11px] mono">
                            <thead>
                                <tr class="text-slate-700 border-b border-white/5">
                                    <th class="px-10 py-5">Monitor descriptor</th>
                                    <th class="px-10 py-5">Observed Value</th>
                                    <th class="px-10 py-5">System State</th>
                                    <th class="px-10 py-5 text-right">Sampled @ Yangon</th>
                                </tr>
                            </thead>
                            <tbody id="registryBody" class="divide-y divide-white/5">
                                <!-- Dynamic audit rows -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Diagnostics & Processes Tabs (Styled v5) -->
            <div id="tab-loggers" class="tab-content glass p-10 rounded-[2.5rem]">
                <div class="flex justify-between items-center mb-10">
                    <h3 class="text-xl font-black text-white uppercase tracking-tighter">Diagnostics audit</h3>
                    <input type="text" id="logFilter" placeholder="Filter loggers..." class="bg-white/5 border border-white/10 rounded-2xl px-6 py-3 text-xs outline-none focus:ring-2 ring-blue-500 w-96 text-white">
                </div>
                <div class="max-h-[600px] overflow-y-auto custom-scrollbar"><table class="w-full text-left text-[11px] mono"><tbody id="logTable"></tbody></table></div>
            </div>

            <div id="tab-threads" class="tab-content glass p-10 rounded-[2.5rem] space-y-10">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-black text-white uppercase tracking-tighter">Process Diagnostic Snapshots</h3>
                    <button onclick="fetchThreads()" class="px-6 py-2 bg-blue-600 text-white text-[10px] font-black uppercase tracking-widest rounded-xl hover:bg-blue-700 transition-all">Capture Dump</button>
                </div>
                <div id="threadList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-h-[600px] overflow-y-auto pr-4 custom-scrollbar"></div>
            </div>

        </div>
    </main>

    <script>
        const token = sessionStorage.getItem('admin_token');
        if (!token) window.location.href = '/admin/login';

        // Time Engine: Asia/Yangon (UTC +6:30)
        function toYangonTime(dateInput) {
            const date = typeof dateInput === 'string' ? new Date(dateInput) : dateInput;
            return date.toLocaleString('en-US', { 
                timeZone: 'Asia/Yangon', 
                hour12: false, 
                hour: '2-digit', minute: '2-digit', second: '2-digit',
                year: 'numeric', month: '2-digit', day: '2-digit'
            }).replace(',', '');
        }

        function updateClocks() {
            const now = new Date();
            document.getElementById('yangonClock').textContent = `${toYangonTime(now).split(' ')[1]} MM-T (UTC+6:30)`;
        }
        setInterval(updateClocks, 1000);

        // Core API Wrapper
        async function fetchActuator(endpoint) {
            try {
                const r = await fetch(`/actuator/${endpoint}`, { headers: { 'Authorization': `Bearer ${token}` } });
                if (r.status === 401) window.location.href = '/admin/login';
                return await r.json();
            } catch (e) { return null; }
        }

        // Memory Chart v5 (Optimized Lifecycle Stream)
        const memChart = new Chart(document.getElementById('memStreamChart').getContext('2d'), {
            type: 'line',
            data: { 
                labels: [], 
                datasets: [{ 
                    label: 'Heap Memory Stream', data: [], 
                    borderColor: '#3b82f6', backgroundColor: 'rgba(59, 130, 246, 0.05)', 
                    borderWidth: 3, fill: true, tension: 0.45, pointRadius: 0 
                }] 
            },
            options: { 
                maintainAspectRatio: false, 
                plugins: { legend: { display: false } },
                scales: { 
                    x: { display: false }, 
                    y: { grid: { color: 'rgba(255,255,255,0.03)' }, border: { display: false }, ticks: { font: { family: 'JetBrains Mono', size: 9 }, color: '#475569' } } 
                } 
            }
        });

        let lastRpsCount = 0;
        let lastRpsTime = Date.now();

        async function updateTelemetry() {
            const nowYangon = toYangonTime(new Date()).split(' ')[1];
            document.getElementById('lastUpdatedYangon').textContent = `Sync: ${nowYangon}`;

            // 1. Business & User State
            const biz = await (await fetch('/api/v1/admin/business-metrics', { headers: { 'Authorization': `Bearer ${token}` } })).json();
            if (biz) {
                document.getElementById('activeUsers').textContent = biz.activeUsers;
                document.getElementById('totalUsers').textContent = biz.totalUsers.toLocaleString();
                document.getElementById('newUsers').textContent = biz.newUsersToday;
            }

            // 2. Performance Engineering
            const busyThreads = await fetchActuator('metrics/tomcat.threads.busy');
            const busyVal = busyThreads?.measurements[0].value || 0;
            document.getElementById('activeReqs').textContent = busyVal;
            const sat = Math.min((busyVal / 20) * 100, 100);
            document.getElementById('reqSaturation').textContent = `${sat.toFixed(1)}%`;
            document.getElementById('reqBar').style.width = `${sat}%`;

            const dbA = await fetchActuator('metrics/hikaricp.connections.active');
            const dbM = await fetchActuator('metrics/hikaricp.connections.max');
            const dbP = await fetchActuator('metrics/hikaricp.connections.pending');
            document.getElementById('dbActive').textContent = dbA?.measurements[0].value || 0;
            document.getElementById('dbMax').textContent = dbM?.measurements[0].value || 0;
            document.getElementById('dbPending').textContent = `PEND: ${dbP?.measurements[0].value || 0}`;

            const reqs = await fetchActuator('metrics/http.server.requests');
            if (reqs) {
                const count = reqs.measurements.find(m => m.statistic === 'COUNT')?.value || 0;
                const now = Date.now();
                const diff = (now - lastRpsTime) / 1000;
                const rps = (count - lastRpsCount) / diff;
                document.getElementById('rpsValue').textContent = `${Math.max(0, rps).toFixed(2)} RPS`;
                lastRpsCount = count;
                lastRpsTime = now;
            }

            // 3. System & Resource Stream
            const heapUsed = await fetchActuator('metrics/jvm.memory.used');
            const heapMax = await fetchActuator('metrics/jvm.memory.max');
            if (heapUsed) {
                const usedMB = Math.round(heapUsed.measurements[0].value / 1024 / 1024);
                const maxMB = Math.round((heapMax?.measurements[0].value || 0) / 1024 / 1024);
                document.getElementById('heapText').textContent = `${usedMB} MB`;
                document.getElementById('maxHeapText').textContent = `${maxMB} MB`;
                
                memChart.data.labels.push("");
                memChart.data.datasets[0].data.push(usedMB);
                if (memChart.data.labels.length > 50) { memChart.data.labels.shift(); memChart.data.datasets[0].data.shift(); }
                memChart.update('none');
            }

            const cpu = await fetchActuator('metrics/system.cpu.usage');
            const cpuVal = (cpu?.measurements[0].value || 0) * 100;
            document.getElementById('cpuText').textContent = `${cpuVal.toFixed(1)}%`;
            document.getElementById('cpuGauge').style.width = `${cpuVal}%`;

            const load = await fetchActuator('metrics/system.load.average.1m');
            const lVal = load?.measurements[0].value || 0;
            document.getElementById('loadText').textContent = lVal.toFixed(2);
            document.getElementById('loadGauge').style.width = `${Math.min(lVal * 10, 100)}%`;

            const files = await fetchActuator('metrics/process.files.open');
            document.getElementById('openFiles').textContent = files?.measurements[0].value || 0;

            // 4. Infrastructure Health
            const health = await fetchActuator('health');
            if (health) {
                document.getElementById('globalHealth').textContent = health.status === 'UP' ? 'System Optimized' : 'System Degraded';
                document.getElementById('healthDot').className = `w-2 h-2 rounded-full ${health.status === 'UP' ? 'bg-emerald-500 shadow-lg pulse-emerald' : 'bg-rose-500 shadow-lg'}`;
                
                document.getElementById('healthDetailsGrid').innerHTML = Object.entries(health.components || {}).map(([name, data]) => `
                    <div class="flex justify-between items-center text-[10px] font-bold">
                        <span class="text-slate-600 uppercase tracking-widest">${name}</span>
                        <span class="${data.status === 'UP' ? 'text-emerald-500' : 'text-rose-500'}">${data.status}</span>
                    </div>
                `).join('');
            }

            // 5. Audit Registry
            const auditData = [
                { id: 'jvm.threads.live', label: 'Daemon Life Cycles', state: 'ACTIVE' },
                { id: 'jvm.gc.pause', label: 'GC Memory Reclaiming', state: 'OPTIMAL' },
                { id: 'process.uptime', label: 'Continuity Duration', state: 'STABLE' }
            ];
            let auditHtml = '';
            for (const item of auditData) {
                const m = await fetchActuator(`metrics/${item.id}`);
                const val = m?.measurements[0].value.toFixed(0) || 0;
                auditHtml += `<tr class="hover:bg-white/[0.01]"><td class="px-10 py-5 text-slate-500 font-bold uppercase tracking-widest">${item.label}</td><td class="px-10 py-5 text-white font-black">${val}</td><td class="px-10 py-5"><span class="text-blue-500 font-black">${item.state}</span></td><td class="px-10 py-5 text-right text-slate-700 font-bold">${nowYangon}</td></tr>`;
            }
            document.getElementById('registryBody').innerHTML = auditHtml;
        }

        // Navigation
        function switchTab(t) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.sidebar-btn').forEach(el => el.classList.remove('sidebar-active'));
            document.getElementById('tab-'+t).classList.add('active');
            document.getElementById('btn-'+t).classList.add('sidebar-active');
            if (t === 'loggers') fetchLoggers();
        }

        async function fetchLoggers() {
            const data = await fetchActuator('loggers');
            if (data) {
                const filter = document.getElementById('logFilter').value.toLowerCase();
                document.getElementById('logTable').innerHTML = Object.entries(data.loggers)
                    .filter(([n]) => n.toLowerCase().includes(filter))
                    .map(([n, l]) => `<tr class="border-b border-white/5 hover:bg-white/[0.01]"><td class="py-4 px-10 text-slate-500">${n}</td><td class="py-4 px-10 text-right font-black text-blue-500">${l.effectiveLevel}</td></tr>`).join('');
            }
        }
        document.getElementById('logFilter').oninput = fetchLoggers;

        async function fetchThreads() {
            const data = await fetchActuator('threaddump');
            if (data) {
                document.getElementById('threadList').innerHTML = data.threads.map(t => `
                    <div class="glass p-5 rounded-2xl text-[10px] mono border border-white/5 hover:border-blue-500/30 transition-all">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-blue-400 font-bold tracking-tighter">#${t.threadId} ${t.threadName}</span>
                            <span class="${t.threadState === 'RUNNABLE' ? 'text-emerald-500' : 'text-amber-500'} font-black uppercase text-[8px]">${t.threadState}</span>
                        </div>
                        <div class="text-slate-600 truncate opacity-60">${t.stackTrace[0]?.className || 'N/A'}.${t.stackTrace[0]?.methodName || ''}</div>
                    </div>
                `).join('');
            }
        }

        function logout() { sessionStorage.clear(); window.location.href = '/admin/login'; }

        // Start Node
        updateTelemetry();
        setInterval(updateTelemetry, 5000);
        switchTab('dashboard');
    </script>
</body>
</html>
